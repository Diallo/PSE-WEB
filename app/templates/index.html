<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    {% if id %}
        <title>{{ id }}'s mood</title>
    {% else %}
        <title>Welcome to High Mood </title>
    {% endif %}
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/ >
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/style.css') }}">
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/linechart.css') }}">
    <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/songMetric.css') }}">
    <link rel='icon' href="{{ url_for('static',filename='img/favicon.ico') }}" type='image/x-icon'>

    <!-- JQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <!-- Radar Chart -->
    <script src="{{ url_for('static',filename='js/radarChart.js') }}"></script>
    <script src="{{ url_for('static',filename='js/loadRadar.js') }}"></script>

    <!-- js for text todo move to the specific charts js file-->
    <script src="{{ url_for('static',filename='js/chartText.js') }}"></script>
    <script src="{{ url_for('static',filename='js/buttons.js') }}"></script>

    <!-- js for making the layout-->
    <script src="{{ url_for('static',filename='js/mainPage.js') }}"></script>

    <!-- lineChart-->
    <script src="{{ url_for('static',filename='js/linechart.js') }}"></script>

    <!-- Song Recommendation-->
    <script src="{{ url_for('static',filename='js/songrecommendation.js') }}"></script>
    <script src="{{ url_for('static',filename='js/songMetricRecommendation.js') }}"></script>

    <!-- Heatmap-->
    <script src="{{ url_for('static',filename='js/heatmap2.js') }}"></script>
    <script src="{{ url_for('static',filename='js/heatmapData.js') }}"></script>

    <!-- Google fonts -->
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>

    <!-- D3.js -->
    <script src="https://d3js.org/d3.v4.min.js" charset="utf-8"></script>


    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--todo rework external stylesheet? at least place it above with the other stylesheets if needed-->
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
  </head>

  <body class='body' id='body'>

    <!--todo device/screen determination-->
    <script>
      var bigScreen = true;
    </script>

    <!--nav bar-->
    <div class="navigation-bar" id='myNavigationBar'>
        <div class="navItems">
            <a onclick="navigateTo('Radar-Graph')" id="RadarTab">RadarChart</a>
            <a onclick="navigateTo('Line-Graph')" id="LineTab">LineGraph</a>
            <a onclick="navigateTo('Heat-Graph')" id="HeatTab">HeatMap</a>
            <a onclick="navigateTo('Song-Metric-Recommendation')" id="SongRecTab">Metric-Recommendation</a>
            <a onclick="navigateTo('Song-Recommendation')" id="Song-Recommendation-Tab">Song-Recommendation</a>
            <a href="/logout">Logout</a>
            <a class="icon" onclick="showTabs()"><i class="fa fa-bars"></i></a>
        </div>
    </div>

    <!--Todo: is this still needed? if not please remove, otherwise move all includes to head-->
    <!--<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>-->
    <script src="{{ url_for('index_js') }}"></script>

    <!--Welcome for the page-->
    <div id="Welcome-User">
      {% if text %}
        <h1 id="userwelcome" align="center">Welcome {{ text }}, Here's your mood</h1>
        <p id="username" hidden>{{ id }}</p>
      {% endif %}
    </div>

    <div class="divider"> <!------------------------------------------------------------------------------------------->
      <svg width="100%" height="100%" viewBox="0 0 100 10" preserveAspectRatio="none">
        <ellipse cx="50" cy="5" rx="45" ry=".1" fill="black"></ellipse>
      </svg>
    </div>

    <!--Top songs and Radar graph-->
    <div class="mainPage" id="Radar-Graph"></div>

    <script>
      createMainPageTopChart("Radar-Graph","top-Songs","topSongsContainer","radarChart","radarChart","radarText","radarText",bigScreen);
    </script>

    <script>
      getTop10("top-Songs");
    </script>

    <div class="divider"> <!------------------------------------------------------------------------------------------->
      <svg width="100%" height="100%" viewBox="0 0 100 10" preserveAspectRatio="none">
        <ellipse cx="50" cy="5" rx="45" ry=".1" fill="black"></ellipse>
      </svg>
    </div>

    <!--Line graph-->
    <div class="mainPage" id="Line-Graph"></div>

    <script>
      createMainPageChart("Line-Graph","lineGraph","","lineGraphText","",false,bigScreen);
    </script>

    <div id="linechartButtons" style="width: 100%;"></div>
    <script>generateButtons("linechartButtons");</script>

    <div class="divider"> <!------------------------------------------------------------------------------------------->
      <svg width="100%" height="100%" viewBox="0 0 100 10" preserveAspectRatio="none">
        <ellipse cx="50" cy="5" rx="45" ry=".1" fill="black"></ellipse>
      </svg>
    </div>

    <!--heatmap-->
    <div class="mainPage" id="Heat-Graph"></div>

    <script>
      createMainPageChart("Heat-Graph","heatmap","","heatmapText","",true,bigScreen);
    </script>


    <div class="divider"> <!------------------------------------------------------------------------------------------->
      <svg width="100%" height="100%" viewBox="0 0 100 10" preserveAspectRatio="none">
        <ellipse cx="50" cy="5" rx="45" ry=".1" fill="black"></ellipse>
      </svg>
    </div>

    <!--Song Recommendations-->
    <div class="mainPage" id="Song-Metric-Recommendation"></div>

    <script>
      createSongRecommendationElement("Song-Metric-Recommendation");
      MakeNewSongMetricRec("songMetricRecPlayer", "neutral");
    </script>

    <div class="divider"> <!------------------------------------------------------------------------------------------->
      <svg width="100%" height="100%" viewBox="0 0 100 10" preserveAspectRatio="none">
        <ellipse cx="50" cy="5" rx="45" ry=".1" fill="black"></ellipse>
      </svg>
    </div>

    <div class="mainPage">
      <div id="Song-Recommendation">
        <h4 >Song Recommendation Tool</h4>
      </div>
    </div>

    <!--loading user data-->
    <script>
      var userid = document.getElementById("username").textContent;
      console.log(userid);

      var request = new XMLHttpRequest()

      // request.open('GET', 'https://cors-anywhere.herokuapp.com/http://randomelements.nl/highmood/data/dummydata.json', true)
      request.open('GET', 'http://localhost:5000/api/tracks/history/' + userid + '/0', true)
      request.onload = function() {
        var alldata = JSON.parse(this.response)
        var userdata = alldata.resource


        if (request.status >= 200 && request.status < 400) {
          // RadarChart
          createRadarChart(userdata);
          giveText(userdata, "radarText");

          document.getElementsByClassName("radar")[0].onmousemove = hoverRadar;
          document.getElementsByClassName("radar")[0].onmouseout = resetRadarText;

          // Heatmap
          createHeatmap("heatmap","A heatmap of the exitedness and happiness of your songs."
                        ,-10,10,5,"exitedness",-10,10,5,"happiness"
                        ,createHeatmapData(userdata, "name", "exitedness", "happiness"));
          giveText(userdata, "heatmapText");
        }
        else {
          document.getElementById("userwelcome").innerHTML = "Error retrieving data!"
        }
      }
      request.send()

      var linechartRequest= new XMLHttpRequest()

      var metrics = "acousticness, danceability, duration_ms, energy, instrumentalness, key, liveness, loudness, mode, speechiness, tempo, valence";
      song_count = 50;
      // linechartRequest.open('GET', 'https://cors-anywhere.herokuapp.com/http://randomelements.nl/highmood/data/dummysonghistory.json', true)
      linechartRequest.open('GET', 'http://localhost:5000/api/tracks/metrics/' + userid + '/' + metrics + '/' + song_count, true)
      linechartRequest.onload = function() {
        var alldata = JSON.parse(this.response)
        var userdata = alldata.resource
        console.log(userdata)

        if (linechartRequest.status >= 200 && linechartRequest.status < 400) {
          // lineGraph
          createLineGraph(userdata,"lineGraph");
          giveText(userdata,"lineGraphText");
        }
        else {
          document.getElementById("userwelcome").innerHTML = "Error retrieving data!"
        }
      }
      linechartRequest.send()


      createSongRecommendationWidget(userid);
    </script>

  </body>
</html>
